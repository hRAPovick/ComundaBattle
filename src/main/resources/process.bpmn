<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_0fr9mxs" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="4.8.1">
  <bpmn:process id="app-process" name="Печенеги vs Половцы" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1">
      <bpmn:outgoing>SequenceFlow_1fp17al</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:endEvent id="EndEvent_0x6ir2l" name="Battle wined!">
      <bpmn:incoming>SequenceFlow_16gzt2m</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_16gzt2m" sourceRef="say-hello" targetRef="EndEvent_0x6ir2l" />
    <bpmn:userTask id="say-hello" name="Celebrate victory" camunda:candidateUsers="demo">
      <bpmn:incoming>Flow_1hwroei</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_16gzt2m</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_0c0jq80" name="is battle success?">
      <bpmn:incoming>Flow_1rx1m71</bpmn:incoming>
      <bpmn:outgoing>Flow_1hwroei</bpmn:outgoing>
      <bpmn:outgoing>Flow_0bh7xpy</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1hwroei" sourceRef="Gateway_0c0jq80" targetRef="say-hello">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isWin}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="Event_0ukpmoe" name="Battle failed!">
      <bpmn:incoming>Flow_1h8cjsj</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_0bh7xpy" sourceRef="Gateway_0c0jq80" targetRef="Activity_1i5xq31">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!isWin}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1h8cjsj" sourceRef="Activity_1i5xq31" targetRef="Event_0ukpmoe" />
    <bpmn:userTask id="Activity_1i5xq31" name="Get defeat">
      <bpmn:incoming>Flow_0bh7xpy</bpmn:incoming>
      <bpmn:outgoing>Flow_1h8cjsj</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:userTask id="Activity_1con0o0" name="Prepare to battle again :)">
      <bpmn:incoming>Flow_0x0eguv</bpmn:incoming>
      <bpmn:outgoing>Flow_1x3mx21</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:serviceTask id="Activity_0lx9j5h" name="Prepare to battle!" camunda:delegateExpression="${prepareToBattle}">
      <bpmn:incoming>SequenceFlow_1fp17al</bpmn:incoming>
      <bpmn:incoming>Flow_1x3mx21</bpmn:incoming>
      <bpmn:outgoing>Flow_07al4rl</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_07al4rl" sourceRef="Activity_0lx9j5h" targetRef="Activity_1kbpf0j" />
    <bpmn:sequenceFlow id="SequenceFlow_1fp17al" sourceRef="StartEvent_1" targetRef="Activity_0lx9j5h" />
    <bpmn:boundaryEvent id="Event_1666kzu" attachedToRef="Activity_0lx9j5h">
      <bpmn:outgoing>Flow_0x0eguv</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_11ja6wg" errorRef="Error_0bif7my" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="Flow_0x0eguv" sourceRef="Event_1666kzu" targetRef="Activity_1con0o0" />
    <bpmn:sequenceFlow id="Flow_1psywsr" sourceRef="Activity_125uwxg" targetRef="Gateway_1aqf3nm" />
    <bpmn:sequenceFlow id="Flow_1rx1m71" sourceRef="Activity_1p04k3d" targetRef="Gateway_0c0jq80" />
    <bpmn:scriptTask id="Activity_1p04k3d" name="Evaluate the battle" scriptFormat="JavaScript">
      <bpmn:incoming>Flow_1katt06</bpmn:incoming>
      <bpmn:incoming>Flow_0do8yd5</bpmn:incoming>
      <bpmn:incoming>Flow_0w97d5q</bpmn:incoming>
      <bpmn:outgoing>Flow_1rx1m71</bpmn:outgoing>
      <bpmn:script>var warriors = execution.getVariable("warriors");
var enemyWarriors = execution.getVariable("enemyWarriors");

if (warriors &gt; enemyWarriors) {
    execution.setVariable("isWin", true);
    execution.setVariable("battleStatus", "Pobeda!");
} else {
    execution.setVariable("isWin", false);
    execution.setVariable("battleStatus", "Defeat!");
}</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:exclusiveGateway id="Gateway_1aqf3nm" name="Is Alive" default="Flow_1katt06">
      <bpmn:incoming>Flow_1psywsr</bpmn:incoming>
      <bpmn:outgoing>Flow_1katt06</bpmn:outgoing>
      <bpmn:outgoing>Flow_08214e0</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1katt06" sourceRef="Gateway_1aqf3nm" targetRef="Activity_1p04k3d" />
    <bpmn:userTask id="Activity_05svdho" name="Send them back">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="sendBack" label="Send back to battle?" type="boolean" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_08214e0</bpmn:incoming>
      <bpmn:outgoing>Flow_11c9092</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_08214e0" name="Yes" sourceRef="Gateway_1aqf3nm" targetRef="Activity_05svdho">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${ army.size() &gt; 1  &amp;&amp; enemyWarriors &gt; 1 }</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:exclusiveGateway id="Gateway_0pzp94h" name="Send back?" default="Flow_0do8yd5">
      <bpmn:incoming>Flow_11c9092</bpmn:incoming>
      <bpmn:outgoing>Flow_0do8yd5</bpmn:outgoing>
      <bpmn:outgoing>Flow_0u9shcu</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_11c9092" sourceRef="Activity_05svdho" targetRef="Gateway_0pzp94h" />
    <bpmn:sequenceFlow id="Flow_0do8yd5" sourceRef="Gateway_0pzp94h" targetRef="Activity_1p04k3d" />
    <bpmn:sequenceFlow id="Flow_0u9shcu" name="Yes" sourceRef="Gateway_0pzp94h" targetRef="Activity_125uwxg">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${ sendBack }</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:subProcess id="Activity_125uwxg">
      <bpmn:incoming>Flow_0u9shcu</bpmn:incoming>
      <bpmn:incoming>Flow_022aw88</bpmn:incoming>
      <bpmn:outgoing>Flow_1psywsr</bpmn:outgoing>
      <bpmn:serviceTask id="Activity_1h2jzsp" name="Fight the enemy!" camunda:delegateExpression="${fightEnemy}">
        <bpmn:incoming>Flow_0a6al27</bpmn:incoming>
        <bpmn:outgoing>Flow_0yija6u</bpmn:outgoing>
        <bpmn:multiInstanceLoopCharacteristics camunda:asyncBefore="true" camunda:collection="army" camunda:elementVariable="warrior">
          <bpmn:completionCondition xsi:type="bpmn:tFormalExpression">${army.size() &lt; 1 || enemyWarriors &lt; 1}</bpmn:completionCondition>
        </bpmn:multiInstanceLoopCharacteristics>
      </bpmn:serviceTask>
      <bpmn:startEvent id="Event_1swsxrx">
        <bpmn:outgoing>Flow_0a6al27</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:endEvent id="Event_0fveve2">
        <bpmn:incoming>Flow_0yija6u</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_0a6al27" sourceRef="Event_1swsxrx" targetRef="Activity_1h2jzsp" />
      <bpmn:sequenceFlow id="Flow_0yija6u" sourceRef="Activity_1h2jzsp" targetRef="Event_0fveve2" />
      <bpmn:subProcess id="Activity_142yzfa" triggeredByEvent="true">
        <bpmn:startEvent id="Event_0uob7iv">
          <bpmn:outgoing>Flow_0x14v29</bpmn:outgoing>
          <bpmn:conditionalEventDefinition id="ConditionalEventDefinition_0q89q9w">
            <bpmn:condition xsi:type="bpmn:tFormalExpression">${army.size () == 6}</bpmn:condition>
          </bpmn:conditionalEventDefinition>
        </bpmn:startEvent>
        <bpmn:sequenceFlow id="Flow_0x14v29" sourceRef="Event_0uob7iv" targetRef="Activity_1pm9zld" />
        <bpmn:sequenceFlow id="Flow_1ydlcgz" sourceRef="Activity_1pm9zld" targetRef="Event_0aqd7fm" />
        <bpmn:endEvent id="Event_0aqd7fm">
          <bpmn:incoming>Flow_1ydlcgz</bpmn:incoming>
          <bpmn:errorEventDefinition id="ErrorEventDefinition_0h230ti" errorRef="Error_1nt2nme" />
        </bpmn:endEvent>
        <bpmn:userTask id="Activity_1pm9zld" name="Escape from battle">
          <bpmn:incoming>Flow_0x14v29</bpmn:incoming>
          <bpmn:outgoing>Flow_1ydlcgz</bpmn:outgoing>
        </bpmn:userTask>
      </bpmn:subProcess>
    </bpmn:subProcess>
    <bpmn:boundaryEvent id="Event_1qnv2qr" attachedToRef="Activity_125uwxg">
      <bpmn:outgoing>Flow_0w97d5q</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_1czkvbm" errorRef="Error_1nt2nme" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="Flow_0w97d5q" sourceRef="Event_1qnv2qr" targetRef="Activity_1p04k3d" />
    <bpmn:sequenceFlow id="Flow_1x3mx21" sourceRef="Activity_1con0o0" targetRef="Activity_0lx9j5h" />
    <bpmn:sequenceFlow id="Flow_022aw88" sourceRef="Activity_1kbpf0j" targetRef="Activity_125uwxg" />
    <bpmn:userTask id="Activity_1kbpf0j" name="Send to battle">
      <bpmn:incoming>Flow_07al4rl</bpmn:incoming>
      <bpmn:outgoing>Flow_022aw88</bpmn:outgoing>
    </bpmn:userTask>
  </bpmn:process>
  <bpmn:error id="Error_0bif7my" name="warriorsError" errorCode="warriorsError" />
  <bpmn:error id="Error_1nt2nme" name="escape" errorCode="escape" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="app-process">
      <bpmndi:BPMNEdge id="Flow_0w97d5q_di" bpmnElement="Flow_0w97d5q">
        <di:waypoint x="850" y="102" />
        <di:waypoint x="850" y="80" />
        <di:waypoint x="1100" y="80" />
        <di:waypoint x="1100" y="277" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0u9shcu_di" bpmnElement="Flow_0u9shcu">
        <di:waypoint x="1100" y="515" />
        <di:waypoint x="1100" y="600" />
        <di:waypoint x="740" y="600" />
        <di:waypoint x="740" y="545" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="921" y="583" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0do8yd5_di" bpmnElement="Flow_0do8yd5">
        <di:waypoint x="1100" y="465" />
        <di:waypoint x="1100" y="357" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_11c9092_di" bpmnElement="Flow_11c9092">
        <di:waypoint x="1040" y="490" />
        <di:waypoint x="1075" y="490" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_08214e0_di" bpmnElement="Flow_08214e0">
        <di:waypoint x="990" y="342" />
        <di:waypoint x="990" y="450" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="996" y="393" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1katt06_di" bpmnElement="Flow_1katt06">
        <di:waypoint x="1015" y="317" />
        <di:waypoint x="1050" y="317" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1rx1m71_di" bpmnElement="Flow_1rx1m71">
        <di:waypoint x="1150" y="317" />
        <di:waypoint x="1225" y="317" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1psywsr_di" bpmnElement="Flow_1psywsr">
        <di:waypoint x="920" y="317" />
        <di:waypoint x="965" y="317" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_07al4rl_di" bpmnElement="Flow_07al4rl">
        <di:waypoint x="370" y="317" />
        <di:waypoint x="410" y="317" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1h8cjsj_di" bpmnElement="Flow_1h8cjsj">
        <di:waypoint x="1440" y="440" />
        <di:waypoint x="1502" y="440" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0bh7xpy_di" bpmnElement="Flow_0bh7xpy">
        <di:waypoint x="1250" y="342" />
        <di:waypoint x="1250" y="440" />
        <di:waypoint x="1340" y="440" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1hwroei_di" bpmnElement="Flow_1hwroei">
        <di:waypoint x="1250" y="292" />
        <di:waypoint x="1250" y="200" />
        <di:waypoint x="1340" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_16gzt2m_di" bpmnElement="SequenceFlow_16gzt2m">
        <di:waypoint x="1440" y="200" />
        <di:waypoint x="1502" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1fp17al_di" bpmnElement="SequenceFlow_1fp17al">
        <di:waypoint x="188" y="317" />
        <di:waypoint x="270" y="317" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0x0eguv_di" bpmnElement="Flow_0x0eguv">
        <di:waypoint x="340" y="375" />
        <di:waypoint x="340" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1x3mx21_di" bpmnElement="Flow_1x3mx21">
        <di:waypoint x="290" y="460" />
        <di:waypoint x="290" y="357" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_022aw88_di" bpmnElement="Flow_022aw88">
        <di:waypoint x="510" y="317" />
        <di:waypoint x="560" y="317" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_0x6ir2l_di" bpmnElement="EndEvent_0x6ir2l">
        <dc:Bounds x="1502" y="182" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1489" y="225" width="63" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_08mft2c_di" bpmnElement="say-hello">
        <dc:Bounds x="1340" y="160" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0c0jq80_di" bpmnElement="Gateway_0c0jq80" isMarkerVisible="true">
        <dc:Bounds x="1225" y="292" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1286" y="310" width="87" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0ukpmoe_di" bpmnElement="Event_0ukpmoe">
        <dc:Bounds x="1502" y="422" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1490" y="465" width="61" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1p170e4_di" bpmnElement="Activity_1i5xq31">
        <dc:Bounds x="1340" y="400" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_17b7wk2_di" bpmnElement="Activity_1p04k3d">
        <dc:Bounds x="1050" y="277" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1aqf3nm_di" bpmnElement="Gateway_1aqf3nm" isMarkerVisible="true">
        <dc:Bounds x="965" y="292" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="972" y="268" width="36" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1rngbhw_di" bpmnElement="Activity_05svdho">
        <dc:Bounds x="940" y="450" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0pzp94h_di" bpmnElement="Gateway_0pzp94h" isMarkerVisible="true">
        <dc:Bounds x="1075" y="465" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1151" y="480" width="59" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="152" y="299" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_10kxx7i_di" bpmnElement="Activity_1con0o0">
        <dc:Bounds x="270" y="460" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1tml907_di" bpmnElement="Activity_0lx9j5h">
        <dc:Bounds x="270" y="277" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0bpexpc_di" bpmnElement="Activity_1kbpf0j">
        <dc:Bounds x="410" y="277" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_145l5r7_di" bpmnElement="Activity_125uwxg" isExpanded="true">
        <dc:Bounds x="560" y="120" width="360" height="425" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0yija6u_di" bpmnElement="Flow_0yija6u">
        <di:waypoint x="780" y="210" />
        <di:waypoint x="832" y="210" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0a6al27_di" bpmnElement="Flow_0a6al27">
        <di:waypoint x="618" y="210" />
        <di:waypoint x="680" y="210" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Activity_1xcyltv_di" bpmnElement="Activity_1h2jzsp">
        <dc:Bounds x="680" y="170" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1swsxrx_di" bpmnElement="Event_1swsxrx">
        <dc:Bounds x="582" y="192" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0fveve2_di" bpmnElement="Event_0fveve2">
        <dc:Bounds x="832" y="192" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_14vutns_di" bpmnElement="Activity_142yzfa" isExpanded="true">
        <dc:Bounds x="590" y="320" width="308" height="200" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1ydlcgz_di" bpmnElement="Flow_1ydlcgz">
        <di:waypoint x="780" y="420" />
        <di:waypoint x="822" y="420" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0x14v29_di" bpmnElement="Flow_0x14v29">
        <di:waypoint x="646" y="420" />
        <di:waypoint x="680" y="420" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_1mwujwl_di" bpmnElement="Event_0uob7iv">
        <dc:Bounds x="610" y="402" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0ryp7lg_di" bpmnElement="Event_0aqd7fm">
        <dc:Bounds x="822" y="402" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1uuyihl_di" bpmnElement="Activity_1pm9zld">
        <dc:Bounds x="680" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_12ak7ed_di" bpmnElement="Event_1qnv2qr">
        <dc:Bounds x="832" y="102" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0eef42x_di" bpmnElement="Event_1666kzu">
        <dc:Bounds x="322" y="339" width="36" height="36" />
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
